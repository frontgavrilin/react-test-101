{"ast":null,"code":"var _jsxFileName = \"/home/gavrilinvv/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/react-test-101/101/src/Components/Page.js\",\n    _s = $RefreshSig$();\n\nimport { useState } from \"react\";\nimport { useQuery } from \"@apollo/client\";\nimport { Container, Typography, FormControl, InputLabel, Select, MenuItem, TableContainer, Table, TableHead, TableRow, TableCell, TableBody, Paper } from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { PROVIDERS_QUERY } from \"../Queries/providersQuery\";\nimport { TARIFFS_QUERY } from \"../Queries/tariffsQuery\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst REGION_URL = \"moskva\";\nconst useStyles = makeStyles(theme => ({\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 300\n  },\n  selectEmpty: {\n    marginTop: theme.spacing(2)\n  },\n  menuPaper: {\n    maxHeight: 500\n  },\n  greenCell: {\n    backgroundColor: \"lightgreen\"\n  },\n  blueCell: {\n    backgroundColor: \"lightblue\"\n  }\n}));\n\nfunction Page() {\n  _s();\n\n  var _providers$data, _providers$data$provi, _tariffs$data, _tariffs$data$tariffs;\n\n  const classes = useStyles();\n  const [currentProvider, setCurrentProvider] = useState({}); // const [bestTariffs, setBestTariffs] = useState([]);\n\n  const providers = useQuery(PROVIDERS_QUERY, {\n    variables: {\n      filter: `region.url=${REGION_URL}`,\n      limit: 50,\n      offset: 0,\n      sort: \"name\"\n    }\n  });\n  const providersData = (providers === null || providers === void 0 ? void 0 : (_providers$data = providers.data) === null || _providers$data === void 0 ? void 0 : (_providers$data$provi = _providers$data.providers) === null || _providers$data$provi === void 0 ? void 0 : _providers$data$provi.data) || [];\n  const tariffs = useQuery(TARIFFS_QUERY, {\n    skip: !(currentProvider === null || currentProvider === void 0 ? void 0 : currentProvider.id),\n    variables: {\n      filter: `region.url=${REGION_URL}&provider.url_name=${currentProvider.url_name}`,\n      limit: 100,\n      offset: 0,\n      sort: \"name\"\n    }\n  });\n\n  function compareChannels(a, b) {\n    const channelsA = a.tv ? a.tv.channels_hd || 0 : 0;\n    const channelsB = b.tv ? b.tv.channels_hd || 0 : 0;\n    return channelsB - channelsA;\n  }\n\n  const tariffsData = (tariffs === null || tariffs === void 0 ? void 0 : (_tariffs$data = tariffs.data) === null || _tariffs$data === void 0 ? void 0 : (_tariffs$data$tariffs = _tariffs$data.tariffs) === null || _tariffs$data$tariffs === void 0 ? void 0 : _tariffs$data$tariffs.data) || [];\n  const sortedTariffs = tariffsData.slice().sort(compareChannels);\n\n  const handleChange = event => {\n    const foundProvider = providersData.find(x => x.id === +event.target.value);\n\n    if (foundProvider) {\n      setCurrentProvider(foundProvider);\n    }\n  };\n\n  const bestTariffs = []; // useEffect(()=> {\n  //   setBestTariffs(() => [])\n  // }, [sortedTariffs])\n\n  const findTariffs = field => {\n    if (field === \"internet\") {\n      const maxFieldValue = Math.max(...tariffsData.map(e => {\n        var _e$field;\n\n        return ((_e$field = e[field]) === null || _e$field === void 0 ? void 0 : _e$field.speed_in) || 0;\n      }));\n      bestTariffs.push({\n        name: \"Лучшая скорость\",\n        value: tariffsData.map(e => {\n          var _e$field2;\n\n          if (((_e$field2 = e[field]) === null || _e$field2 === void 0 ? void 0 : _e$field2.speed_in) === maxFieldValue) {\n            return e.name;\n          }\n\n          return 0;\n        }).filter(e => e)\n      });\n      return tariffsData.filter(e => {\n        var _e$field3;\n\n        return (((_e$field3 = e[field]) === null || _e$field3 === void 0 ? void 0 : _e$field3.speed_in) || 0) === maxFieldValue;\n      });\n    }\n\n    if (field === \"displayPrice\") {\n      const minFieldValue = Math.min(...tariffsData.map(e => e[field] || 0));\n      bestTariffs.push({\n        name: \"Лучшая цена\",\n        value: tariffsData.map(e => {\n          if (e[field] === minFieldValue) {\n            return e.name;\n          }\n\n          return 0;\n        }).filter(e => e)\n      });\n      return tariffsData.filter(e => (e[field] || 0) === minFieldValue);\n    }\n\n    const maxFieldValue = Math.max(...tariffsData.map(e => {\n      var _e$field4;\n\n      return ((_e$field4 = e[field]) === null || _e$field4 === void 0 ? void 0 : _e$field4.channels) || 0;\n    }));\n    bestTariffs.push({\n      name: \"Больше каналов\",\n      value: tariffsData.map(e => {\n        var _e$field5;\n\n        if (((_e$field5 = e[field]) === null || _e$field5 === void 0 ? void 0 : _e$field5.channels) === maxFieldValue) {\n          return e.name;\n        }\n\n        return 0;\n      }).filter(e => e)\n    });\n    return tariffsData.filter(e => {\n      var _e$field6;\n\n      return (((_e$field6 = e[field]) === null || _e$field6 === void 0 ? void 0 : _e$field6.channels) || 0) === maxFieldValue;\n    });\n  };\n\n  const findTariffsHD = field => {\n    const maxFieldValue = Math.max(...tariffsData.map(e => {\n      var _e$field7;\n\n      return ((_e$field7 = e[field]) === null || _e$field7 === void 0 ? void 0 : _e$field7.channels_hd) || 0;\n    }));\n    const channelsHD = tariffsData.map(e => {\n      var _e$field8;\n\n      if (((_e$field8 = e[field]) === null || _e$field8 === void 0 ? void 0 : _e$field8.channels_hd) === maxFieldValue) {\n        return e.name;\n      }\n\n      return 0;\n    }).filter(e => e);\n    bestTariffs.push({\n      name: \"Больше HD каналов\",\n      value: channelsHD || [\"-\"]\n    });\n    return tariffsData.filter(e => {\n      var _e$field9;\n\n      return (((_e$field9 = e[field]) === null || _e$field9 === void 0 ? void 0 : _e$field9.channels_hd) || 0) === maxFieldValue;\n    });\n  };\n\n  const price = findTariffs(\"displayPrice\");\n  const internetSpeed = findTariffs(\"internet\");\n  const channels = findTariffs(\"tv\");\n  const channelsHD = findTariffsHD(\"tv\");\n  return /*#__PURE__*/_jsxDEV(Container, {\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h3\",\n      component: \"h2\",\n      children: \"\\u0422\\u0430\\u0431\\u043B\\u0438\\u0446\\u0430 \\u0441\\u0440\\u0430\\u0432\\u043D\\u0435\\u043D\\u0438\\u044F\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n      variant: \"outlined\",\n      className: classes.formControl,\n      children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n        id: \"provider-select-label\",\n        children: \"\\u041F\\u0440\\u043E\\u0432\\u0430\\u0439\\u0434\\u0435\\u0440\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Select, {\n        labelId: \"provider-select-label\",\n        id: \"provider-select\",\n        value: (currentProvider === null || currentProvider === void 0 ? void 0 : currentProvider.id) || 0,\n        onChange: handleChange,\n        label: \"Provider\",\n        MenuProps: {\n          classes: {\n            paper: classes.menuPaper\n          }\n        },\n        children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n          value: \"0\",\n          children: /*#__PURE__*/_jsxDEV(\"em\", {\n            children: \"None\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this), providersData.filter(x => x.info.cnt_tariffs > 0).map(provider => /*#__PURE__*/_jsxDEV(MenuItem, {\n          value: provider.id,\n          children: provider.name\n        }, provider.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 15\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TableContainer, {\n      component: Paper,\n      children: /*#__PURE__*/_jsxDEV(Table, {\n        children: [/*#__PURE__*/_jsxDEV(TableHead, {\n          children: /*#__PURE__*/_jsxDEV(TableRow, {\n            children: [/*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u041D\\u0430\\u0437\\u0432\\u0430\\u043D\\u0438\\u0435 \\u0442\\u0430\\u0440\\u0438\\u0444\\u0430\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u0426\\u0435\\u043D\\u0430\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 198,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u0421\\u043A\\u043E\\u0440\\u043E\\u0441\\u0442\\u044C \\u0438\\u043D\\u0442\\u0435\\u0440\\u043D\\u0435\\u0442\\u0430\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 199,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E \\u0442\\u0435\\u043B\\u0435\\u043A\\u0430\\u043D\\u0430\\u043B\\u043E\\u0432\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 200,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              children: \"\\u041A\\u043E\\u043B\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043E HD-\\u0442\\u0435\\u043B\\u0435\\u043A\\u0430\\u043D\\u0430\\u043B\\u043E\\u0432\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 195,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TableBody, {\n          children: sortedTariffs.map(tariff => {\n            var _tariff$tv2, _tariff$tv3, _tariff$tv5, _tariff$tv6;\n\n            return /*#__PURE__*/_jsxDEV(TableRow, {\n              children: [/*#__PURE__*/_jsxDEV(TableCell, {\n                component: \"th\",\n                scope: \"row\",\n                children: tariff.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 207,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                className: price.find(e => e.id === tariff.id) ? classes.greenCell : price.length > 1 && price.find(e => e.displayPrice === tariff.displayPrice) ? classes.blueCell : \"\",\n                children: tariff.displayPrice || \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 210,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                className: internetSpeed.find(e => e.id === tariff.id) ? classes.blueCell : internetSpeed.length > 1 && internetSpeed.find(e => e.internet.speed_in === tariff.internet.speed_in) ? classes.greenCell : \"\",\n                children: tariff.internet.speed_in || \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                className: channels.find(e => e.id === tariff.id) ? classes.blueCell : channels.length > 1 && channels.find(e => {\n                  var _e$tv, _tariff$tv;\n\n                  return ((_e$tv = e.tv) === null || _e$tv === void 0 ? void 0 : _e$tv.channels) === ((_tariff$tv = tariff.tv) === null || _tariff$tv === void 0 ? void 0 : _tariff$tv.channels);\n                }) ? classes.greenCell : \"\",\n                children: ((_tariff$tv2 = tariff.tv) === null || _tariff$tv2 === void 0 ? void 0 : _tariff$tv2.channels) || \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 234,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n                className: channelsHD.find(e => e.id === tariff.id) && ((_tariff$tv3 = tariff.tv) === null || _tariff$tv3 === void 0 ? void 0 : _tariff$tv3.channels_hd) ? classes.blueCell : channelsHD.length > 1 && channelsHD.find(e => {\n                  var _e$tv2, _tariff$tv4;\n\n                  return ((_e$tv2 = e.tv) === null || _e$tv2 === void 0 ? void 0 : _e$tv2.channels_hd) === ((_tariff$tv4 = tariff.tv) === null || _tariff$tv4 === void 0 ? void 0 : _tariff$tv4.channels_hd);\n                }) ? classes.greenCell && ((_tariff$tv5 = tariff.tv) === null || _tariff$tv5 === void 0 ? void 0 : _tariff$tv5.channels_hd) : \"\",\n                children: ((_tariff$tv6 = tariff.tv) === null || _tariff$tv6 === void 0 ? void 0 : _tariff$tv6.channels_hd) || \"-\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 244,\n                columnNumber: 17\n              }, this)]\n            }, tariff.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 206,\n              columnNumber: 15\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(TableContainer, {\n      component: Paper,\n      children: /*#__PURE__*/_jsxDEV(Table, {\n        children: /*#__PURE__*/_jsxDEV(TableBody, {\n          children: bestTariffs.map(e => /*#__PURE__*/_jsxDEV(TableRow, {\n            children: [/*#__PURE__*/_jsxDEV(TableCell, {\n              children: e.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 266,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(TableCell, {\n              align: \"left\",\n              children: e.value.join(\", \")\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 267,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 263,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 261,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Page, \"D8qdf/FeE6nUFdswFA+M4rwudGo=\", false, function () {\n  return [useStyles, useQuery, useQuery];\n});\n\n_c = Page;\nexport default Page;\n\nvar _c;\n\n$RefreshReg$(_c, \"Page\");","map":{"version":3,"sources":["/home/gavrilinvv/Документы/react-test-101/101/src/Components/Page.js"],"names":["useState","useQuery","Container","Typography","FormControl","InputLabel","Select","MenuItem","TableContainer","Table","TableHead","TableRow","TableCell","TableBody","Paper","makeStyles","PROVIDERS_QUERY","TARIFFS_QUERY","REGION_URL","useStyles","theme","formControl","margin","spacing","minWidth","selectEmpty","marginTop","menuPaper","maxHeight","greenCell","backgroundColor","blueCell","Page","classes","currentProvider","setCurrentProvider","providers","variables","filter","limit","offset","sort","providersData","data","tariffs","skip","id","url_name","compareChannels","a","b","channelsA","tv","channels_hd","channelsB","tariffsData","sortedTariffs","slice","handleChange","event","foundProvider","find","x","target","value","bestTariffs","findTariffs","field","maxFieldValue","Math","max","map","e","speed_in","push","name","minFieldValue","min","channels","findTariffsHD","channelsHD","price","internetSpeed","paper","info","cnt_tariffs","provider","tariff","length","displayPrice","internet","join"],"mappings":"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","sourcesContent":["import { useState } from \"react\";\nimport { useQuery } from \"@apollo/client\";\nimport {\n  Container,\n  Typography,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  TableContainer,\n  Table,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableBody,\n  Paper,\n} from \"@material-ui/core\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { PROVIDERS_QUERY } from \"../Queries/providersQuery\";\nimport { TARIFFS_QUERY } from \"../Queries/tariffsQuery\";\n\nconst REGION_URL = \"moskva\";\n\nconst useStyles = makeStyles((theme) => ({\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 300,\n  },\n  selectEmpty: {\n    marginTop: theme.spacing(2),\n  },\n  menuPaper: {\n    maxHeight: 500,\n  },\n  greenCell: {\n    backgroundColor: \"lightgreen\",\n  },\n  blueCell: {\n    backgroundColor: \"lightblue\",\n  },\n}));\n\nfunction Page() {\n  const classes = useStyles();\n\n  const [currentProvider, setCurrentProvider] = useState({});\n\n  // const [bestTariffs, setBestTariffs] = useState([]);\n\n  const providers = useQuery(PROVIDERS_QUERY, {\n    variables: {\n      filter: `region.url=${REGION_URL}`,\n      limit: 50,\n      offset: 0,\n      sort: \"name\",\n    },\n  });\n  const providersData = providers?.data?.providers?.data || [];\n\n  const tariffs = useQuery(TARIFFS_QUERY, {\n    skip: !currentProvider?.id,\n    variables: {\n      filter: `region.url=${REGION_URL}&provider.url_name=${currentProvider.url_name}`,\n      limit: 100,\n      offset: 0,\n      sort: \"name\",\n    },\n  });\n\n  function compareChannels(a, b) {\n    const channelsA = a.tv ? (a.tv.channels_hd || 0) : 0;\n    const channelsB = b.tv ? (b.tv.channels_hd || 0) : 0;\n    return channelsB - channelsA;\n}\n\n  const tariffsData = tariffs?.data?.tariffs?.data || [];\n  const sortedTariffs = tariffsData.slice().sort(compareChannels);  \n\n  const handleChange = (event) => {\n    const foundProvider = providersData.find(\n      (x) => x.id === +event.target.value,\n    );\n    if (foundProvider) {\n      setCurrentProvider(foundProvider);\n    }\n  };\n\n  const bestTariffs = [];\n  // useEffect(()=> {\n  //   setBestTariffs(() => [])\n  // }, [sortedTariffs])\n  const findTariffs = (field) => {\n    if(field === \"internet\"){\n      const maxFieldValue = Math.max(\n        ...tariffsData.map((e) => e[field]?.speed_in || 0),\n      );\n      bestTariffs.push(\n        {\n          name: \"Лучшая скорость\",\n          value: tariffsData.map((e) => {\n            if(e[field]?.speed_in === maxFieldValue){\n              return e.name\n            }\n            return 0\n          }).filter((e) => e)\n        }\n      );\n      return tariffsData.filter((e) => (e[field]?.speed_in || 0) === maxFieldValue);\n    }\n    if(field === \"displayPrice\"){\n      const minFieldValue = Math.min(\n        ...tariffsData.map((e) => e[field] || 0),\n      );\n      bestTariffs.push(\n        {\n          name: \"Лучшая цена\",\n          value: tariffsData.map((e) => {\n            if(e[field] === minFieldValue){\n              return e.name\n            }\n            return 0\n          }).filter((e) => e)\n        }\n        );\n      return tariffsData.filter((e) => (e[field] || 0) === minFieldValue);\n    }\n    const maxFieldValue = Math.max(\n      ...tariffsData.map((e) => e[field]?.channels || 0),\n    );\n    bestTariffs.push(\n      {\n        name: \"Больше каналов\",\n        value: tariffsData.map((e) => {\n          if(e[field]?.channels === maxFieldValue){\n            return e.name\n          }\n          return 0\n        }).filter((e) => e)\n      }\n    );\n    return tariffsData.filter((e) => (e[field]?.channels || 0) === maxFieldValue);\n  };\n\n  const findTariffsHD = (field) => {\n    const maxFieldValue = Math.max(...tariffsData.map((e) => e[field]?.channels_hd || 0));\n    const channelsHD = tariffsData.map((e) => {\n      if(e[field]?.channels_hd === maxFieldValue){\n        return e.name\n      }\n      return 0\n    }).filter((e) => e)\n    bestTariffs.push(\n      {\n        name: \"Больше HD каналов\",\n        value: channelsHD || [\"-\"]\n      }\n      );\n    return tariffsData.filter((e) => (e[field]?.channels_hd || 0) === maxFieldValue)\n  }\n\n  const price = findTariffs(\"displayPrice\");\n  const internetSpeed = findTariffs(\"internet\");\n  const channels = findTariffs(\"tv\");\n  const channelsHD = findTariffsHD(\"tv\");\n  \n  return (\n    <Container>\n      <Typography variant=\"h3\" component=\"h2\">\n        Таблица сравнения\n      </Typography>\n      <FormControl variant=\"outlined\" className={classes.formControl}>\n        <InputLabel id=\"provider-select-label\">Провайдер</InputLabel>\n        <Select\n          labelId=\"provider-select-label\"\n          id=\"provider-select\"\n          value={currentProvider?.id || 0}\n          onChange={handleChange}\n          label=\"Provider\"\n          MenuProps={{ classes: { paper: classes.menuPaper } }}\n        >\n          <MenuItem value=\"0\">\n            <em>None</em>\n          </MenuItem>\n          {providersData\n            .filter((x) => x.info.cnt_tariffs > 0)\n            .map((provider) => (\n              <MenuItem key={provider.id} value={provider.id}>\n                {provider.name}\n              </MenuItem>\n            ))}\n        </Select>\n      </FormControl>\n      <TableContainer component={Paper}>\n        <Table>\n          <TableHead>\n            <TableRow>\n              <TableCell>Название тарифа</TableCell>\n              <TableCell>Цена</TableCell>\n              <TableCell>Скорость интернета</TableCell>\n              <TableCell>Количество телеканалов</TableCell>\n              <TableCell>Количество HD-телеканалов</TableCell>\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {sortedTariffs.map((tariff) => (\n              <TableRow key={tariff.id}>\n                <TableCell component=\"th\" scope=\"row\">\n                  {tariff.name}\n                </TableCell>\n                <TableCell\n                  className={\n                    price.find((e) => e.id === tariff.id)\n                      ? classes.greenCell\n                      : price.length > 1 &&\n                      price.find((e) => e.displayPrice === tariff.displayPrice)\n                      ? classes.blueCell\n                      : \"\"\n                  }\n                >\n                  {tariff.displayPrice || \"-\"}\n                </TableCell>\n                <TableCell\n                  className={\n                    internetSpeed.find((e) => e.id === tariff.id)\n                      ? classes.blueCell\n                      : internetSpeed.length > 1 &&\n                        internetSpeed.find((e) => e.internet.speed_in === tariff.internet.speed_in)\n                      ? classes.greenCell\n                      : \"\"\n                  }\n                >\n                  {tariff.internet.speed_in || \"-\"}\n                </TableCell>\n                <TableCell\n                  className={\n                    channels.find((e) => e.id === tariff.id) ? classes.blueCell : channels.length > 1 &&\n                      channels.find((e) => e.tv?.channels === tariff.tv?.channels)\n                      ? classes.greenCell\n                      : \"\"\n                  }\n                >\n                  {tariff.tv?.channels || \"-\"}\n                </TableCell>\n                <TableCell\n                  className={\n                    channelsHD.find((e) => e.id === tariff.id) && tariff.tv?.channels_hd\n                      ? classes.blueCell\n                      : channelsHD.length > 1 &&\n                      channelsHD.find((e) => e.tv?.channels_hd === tariff.tv?.channels_hd)\n                      ? classes.greenCell && tariff.tv?.channels_hd\n                      : \"\"\n                  }\n                >\n                  {tariff.tv?.channels_hd || \"-\"}\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n        </Table>\n      </TableContainer >\n      <TableContainer component={Paper}>\n        <Table>\n          <TableBody>\n            {bestTariffs.map((e) => (\n              <TableRow>\n                <TableCell>{e.name}</TableCell>\n                <TableCell align=\"left\">\n                  {e.value.join(\", \")}\n                </TableCell>\n              </TableRow>\n            ))} \n          </TableBody>\n        </Table>\n    </TableContainer>\n    </Container>\n  );\n}\n\nexport default Page;\n"]},"metadata":{},"sourceType":"module"}